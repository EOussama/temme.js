"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var d={temmeIds:{default:[],type:"array",isValid:function(e){return null!=e&&Array.isArray(e)}},name:{default:"div",type:"string",isValid:function(e){return null!=e&&"string"==typeof e}},id:{default:"",type:"string",isValid:function(e){return null!=e&&"string"==typeof e}},classes:{default:[],type:"array",isValid:function(e){return null!=e&&Array.isArray(e)}},attributes:{default:{},type:"object",isValid:function(e){return null!=e&&!Array.isArray(e)&&"object"===_typeof(e)}},dataset:{default:{},type:"object",isValid:function(e){return null!=e&&!Array.isArray(e)&&"object"===_typeof(e)}},text:{default:"",type:"string",isValid:function(e){return null!=e&&"string"==typeof e}},html:{default:"",type:"string",isValid:function(e){return null!=e&&"string"==typeof e}},children:{default:[],type:"array",isValid:function(e){return null!=e&&Array.isArray(e)}},ref:{default:"",type:"string",isValid:function(e){return null!=e&&"string"==typeof e}},from:{default:{ref:"",mode:"append",children:{allow:!1,placement:"after"}},type:"object",keys:{ref:{default:"",type:"string",isValid:function(e){return null!=e&&"string"==typeof e}},mode:{default:"append",type:"string",values:["append","override"],isValid:function(e){return null!=e&&"string"==typeof e}},children:{default:{allow:!1,placement:"after"},type:"object",keys:{allow:{default:!1,type:"boolean",isValid:function(e){return null!=e&&"boolean"==typeof e}},placement:{default:"after",type:"string",values:["after","before"],isValid:function(e){return null!=e&&"string"==typeof e}}},isValid:function(e){return null!=e&&!Array.isArray(e)&&"object"===_typeof(e)}}},isValid:function(e){return null!=e&&!Array.isArray(e)&&"object"===_typeof(e)}},templates:{default:[],type:"array",isValid:function(e){return null!=e&&Array.isArray(e)}},isTemplate:{default:!1,type:"boolean",isValid:function(e){return null!=e&&"boolean"==typeof e}}};function m(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"TemmeError",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"Something went wrong.";this.name=e,this.message=t}function f(t,e){var n,r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];for(var i in t){if(!(i in d))throw new m("InvalidOptionNameError","“".concat(i,"” is not a valid option."));if(!d[i].isValid(t[i]))throw new m("InvalidOptionTypeError","The option “".concat(i,"” must be of type ").concat(d[i].type,"."));if("ref"===i&&"@"===t[i].trim()[0])throw new m("InvalidReference","References should not start with the symbole `@`.")}for(var o in t.temmeIds=Array.from(e),t.temmeIds.push((n="0123456789abcdefghijklmnopqrstuvwxyz",r="",_toConsumableArray(Array(6).keys()).forEach(function(){var e=Math.floor(Math.random()*n.length),t=Math.floor(2*Math.random());r+=1===t?n[e].toUpperCase():n[e]}),r)),d)if(o in t){if("from"===o)if("children"in t.from)for(var l in d.from.keys.children.keys)l in t.from.children||(t.from.children[l]=d.from.keys.children.keys[l].default);else t.from.children=Object.create(d.from.keys.children.default)}else a.includes(o)?t.isTemplate=!0:("object"===d[o].type?t[o]=Object.create(d[o].default):t[o]=d[o].default,!0!==t.isTemplate&&(t.isTemplate=!1));"templates"in t&&t.templates.forEach(function(e){f(e,t.temmeIds,["name","children","templates"])}),"children"in t&&t.children.forEach(function(e){f(e,t.temmeIds)})}function i(f,s,c){var t=3<arguments.length&&void 0!==arguments[3]&&arguments[3];function e(){for(var e in f)switch(e){case"from":if(!("ref"in f.from))throw new m("InvalidReferencingObject","The “from” option must have a “ref” key, otherwise, it's invalid");for(var t in f.from){if(!Object.keys(d.from.keys).includes(t))throw new m("InvalidReferencingObject","“".concat(t,"” is an invalid key to have in the “from” option."));if(!d.from.keys[t].isValid(f.from[t]))throw new m("InvalidReferencingObject","“".concat(f.from[t],"” is not a valid value for “").concat(t,"” of the “from” option."));if("values"in d.from.keys[t]&&!d.from.keys[t].values.includes(f.from[t]))throw new m("InvalidReferencingObject","“".concat(f.from[t],"” is not a valid value for “").concat(t,"” of the “from” option."))}0<f.from.ref.length&&function(){var e=function(e){switch(e){case"append":var t=function(n){if(!["from","ref","id","name","temmeIds","isTemplate","templates",!0!==f.from.children.allow?"children":""].includes(n))switch(d[n].type){case"array":if("children"!==n){var e=o.refElement[n].filter(function(e,t){return!f[n].includes(e)&&o.refElement[n].indexOf(e)===t&&0<e.trim().length}),t=_toConsumableArray(f[n]).concat(_toConsumableArray(e)).sort();f[n]=t}else switch(f.from.children.placement){case"after":var r;(r=f[n]).push.apply(r,_toConsumableArray(o.refElement[n]));break;case"before":var a;(a=f[n]).unshift.apply(a,_toConsumableArray(o.refElement[n]));break;default:throw new m("InvalidReferencingObject","“".concat(f.from.children.placement,"” is an invalid placement."))}break;case"object":for(var i in o.refElement[n])i in f[n]||(f[n][i]=o.refElement[n][i]);break;default:f[n]=o.refElement[n]}};for(var n in o.refElement)t(n);break;case"override":for(var n in o.refElement)if(!["from","ref","name","temmeIds","isTemplate","templates",!0!==f.from.children.allow?"children":""].includes(n))switch(d[n].type){case"object":for(var r in o.refElement[n])f[n][r]=o.refElement[n][r];break;default:f[n]=o.refElement[n]}break;default:throw new m("InvalidReferenceMode","“".concat(e,"” is not a valid referencing mode."))}},o={refElement:{},depth:s,template:!1};if("@"===f.from.ref.trim()[0]){var t=f.from.ref.slice(1),n=document.querySelector(t);if(!(null!=n||n instanceof HTMLElement))throw new m("InvalidReference","No valid HTML element corresponds to the CSS selector “".concat(t,"”"));var r={},a={};for(var i in n.attributes)isNaN(parseInt(i))||["id","class"].includes(n.attributes[i].nodeName)||n.attributes[i].nodeName.startsWith("data-")||(r[n.attributes[i].nodeName]=n.attributes[i].nodeValue);for(var l in n.dataset)a[l]=n.dataset[l];o.refElement={id:n.id,html:n.innerHTML,classes:_toConsumableArray(n.classList),attributes:r,dataset:a}}else o=c.filter(function(e){return e.refElement.ref===f.from.ref&&e.depth<=s}).sort(function(e,t){return t.depth-e.depth})[0];if(!0===f.from.children.allow&&f.temmeIds.includes(o.refElement.temmeIds[o.refElement.temmeIds.length-1]))throw new m("InvalidReference","Elements cannot reference their parents while “from.children.allow” is set to “true”.");if(void 0===o)throw new m("InvalidReference","“".concat(f.from.ref,"” is an invalid reference."));if(!1===o.isTemplate&&!0===f.isTemplate)throw new m("InvalidReference","Templates can only reference other templates.");"mode"in f.from?e(f.from.mode):e("append")}()}}!0===t?!0===f.isTemplate&&e():e(),"templates"in f&&f.templates.forEach(function(e){i(e,++s,c,t)}),"children"in f&&f.children.forEach(function(e){i(e,++s,c,t)})}function t(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(e,t,n){};try{if(null==t||"object"!==_typeof(t)||Array.isArray(t))throw new m("InvalidHierarchyError","The hierarchy object is invalid.");if(!(n instanceof HTMLElement))throw new m("InvalidTargetError","The target must be a valid HTML element.");f(t,[]),function t(e,n,r){"templates"in e&&0<e.templates.length&&e.templates.forEach(function(e){if("name"in e)throw new m("InvalidTemplate","Templates must not have a `name` option.");if("children"in e)throw new m("InvalidTemplate","Templates must not have a `children` option.");if("templates"in e)throw new m("InvalidTemplate","Template nesting is not allowed.");if(!("ref"in e))throw new m("InvalidTemplate","Templates must have a `ref` option, otherwise, they are invalid.");r.push({refElement:e,depth:n,isTemplate:!0})}),"ref"in e&&0<e.ref.length&&r.push({refElement:e,depth:n,isTemplate:!1}),"children"in e&&e.children.forEach(function(e){t(e,++n,r)})}(t,0,e=[]),i(t,0,e,!0),i(t,0,e),function r(a,i,o){var l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(e,t,n){},e=function(n){switch(n){case"id":a[n]!==d[n].default&&(i.id=a[n]);break;case"classes":if(a[n]!==d[n].default){var e=a[n].filter(function(e,t){return!i.classList.contains(e)&&a[n].indexOf(e)===t&&0<e.trim().length}),t=_toConsumableArray(i.classList).concat(_toConsumableArray(e)).sort().join(" ");i.classList=t}break;case"attributes":a[n]!==d[n].default&&Object.keys(a[n]).forEach(function(e){i.setAttribute(e,a[n][e])});break;case"dataset":a[n]!==d[n].default&&Object.assign(i.dataset,a[n]);break;case"text":a[n]!==d[n].default&&(i.textContent=a[n]);break;case"html":a[n]!==d[n].default&&(i.innerHTML=a[n]);break;case"children":a[n]!==d[n].default&&a.children.forEach(function(e){var t=document.createElement(e.name);i.appendChild(t),r(e,t,++o,l)})}};for(var t in a)e(t);l(a.temmeIds[a.temmeIds.length-1],a,o)}(t,n,0,a),r()}catch(e){throw e.message="[Temme JS]: ".concat(e.message),e}}m.prototype=Error.prototype,"undefined"!=typeof exports?module.exports=t:e.Temme=t}("undefined"!=typeof window?window:void 0);